<!DOCTYPE html>
<html>

<meta charset="UTF-8">
<head>
<title>Page Title</title>
</head>
<script type="text/javascript">

var measures = [];
var samples = 0;

function sma(){
	let sum = 0;

	measures.forEach( measure => {
		sum += (Math.abs(measure.x) + Math.abs(measure.y) + Math.abs(measure.z));
	})

    return Math.sqrt(sum / measures.length);
}
window.onload = function(){
	
	try{
		navigator.permissions.query({ name: 'accelerometer' }).then(result => {
			if (result.state === 'denied') {
				document.getElementById("error").innerHTML = 'Permission to use accelerometer sensor is denied.';
				return;
			}

			let sensor = new Accelerometer({frequency: 1});

			sensor.start();

			
			sensor.onreading = () => {
				document.getElementById("x").innerHTML = "Acceleration along X-axis: " + sensor.x;
				document.getElementById("y").innerHTML = "Acceleration along Y-axis: " + sensor.y;
				document.getElementById("z").innerHTML = "Acceleration along Z-axis: " + sensor.z;

				measures.push({x: sensor.x, y: sensor.y, z: sensor.z});
				samples++;
				document.getElementById("samples").innerHTML = "samples: " + samples;
				if(samples == 60){
					let sma = this.sma();	
					document.getElementById("sma").innerHTML = "SMA: "+sma+" ("+new Date()+")";
					measures = [];
					samples = 0;
				}
				
			}

			sensor.onerror = event => console.log(event.error.name, event.error.message);
		});
	}
	catch(e){
		let errorMsg = "";
		
		if (error.name === 'SecurityError') {
			errorMsg = 'Sensor construction was blocked by the Feature Policy.';
		} else if (error.name === 'ReferenceError') {
			errorMsg = 'Sensor is not supported by the User Agent.';
		} else {
			errorMsg = 'Error'
		}
		document.getElementById("error").innerHTML = errorMsg;
	}
}
</script>
<body>

<h1>User Activity Recognition</h1>
<p>A simple crowd-sensing model.</p>
<p id="samples">samples</p>
<p id="error"></p>
<ul>
  <li id="x">X:</li>
  <li id="y">Y:</li>
  <li id="z">Z:</li>
</ul> 
<p id="sma"></p>

</body>
</html> 